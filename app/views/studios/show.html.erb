<%= render partial: "partials/header", locals: {
  current_user: current_user,
  is_angular: false
} %>

<div id="wrapper">

  <!-- SLIDER -->
  <section class="fullheight" style="background-image:url('/assets/images/backgrounds/clouds.jpg')">
    <div class="overlay light-9"><!-- dark overlay [0 to 9 opacity] --></div>

    <div class="display-table">
      <div class="display-table-cell vertical-align-middle">
        <section>
          <div class="container">
            <div class="row">
              <div class="col-lg-9 col-sm-9">
                <h1 class="bold"><%= @studio.name %></h1>
              </div>
              <!-- buttons -->
              <div class="col-lg-3 col-sm-3">
                <% if user_signed_in? %>
                <a class="btn btn-default add-wishlist pull-right" href="#" data-item-id="1" data-toggle="tooltip" title="Add To Favorite Studios"><i class="fa fa-heart nopadding"></i></a>
                <% end %>
              </div>
              <!-- /buttons -->
            </div>

            <hr>

            <div class="row">

              <!-- IMAGE -->
              <div class="col-lg-4 col-sm-4">

                <div class="thumbnail relative margin-bottom-3">

                <!-- 
                  IMAGE ZOOM 
                  
                  data-mode="mouseover|grab|click|toggle"
                -->
                <figure id="zoom-primary" class="zoom" data-mode="mouseover">
                  <!-- 
                    zoom buttton
                    
                    positions available:
                      .bottom-right
                      .bottom-left
                      .top-right
                      .top-left
                    -->
                    <% if @studio.studio_images.any? %>
                      <a class="lightbox bottom-right" href="<%= @studio.studio_images.first.url %>" data-plugin-options='{"type":"image"}'><i class="glyphicon glyphicon-search"></i></a>

                      <img class="img-responsive" src="<%= @studio.studio_images.first.url %>" width="1200" height="1500" alt="Studio picture" />

                    <% else %>
                      <a class="lightbox bottom-right" href="http://img.talkandroid.com/uploads/2014/10/YogaStudio.png" data-plugin-options='{"type":"image"}'><i class="glyphicon glyphicon-search"></i></a>

                    <!-- 
                      image 
                      
                      Extra: add .image-bw class to force black and white!
                    -->
                      <img class="img-responsive" src="http://img.talkandroid.com/uploads/2014/10/YogaStudio.png" width="1200" height="1500" alt="Studio picture" />
                    <% end %>
                  </figure>

                </div>

                <!-- Thumbnails (required height:100px) -->
                <div data-for="zoom-primary" class="zoom-more owl-carousel owl-padding-3 featured" data-plugin-options='{"singleItem": false, "autoPlay": false, "navigation": true, "pagination": false}'>
                  <% if @studio.studio_images %>
                    <% @studio.studio_images.each do |image| %>
                      <a class="thumbnail active" href="<%= image.url %>">
                        <img src="<%= image.url %>" height="100" alt="" />
                      </a>
                    <% end %>
                  <% end %>
                </div>
                <!-- /Thumbnails -->
                <div class="divider divider-center"><!-- divider -->
                  <i class="fa fa-hand-peace-o"></i>
                </div>


                <% if user_signed_in? && current_user.role_id == 1 %>
                <h4 class="size-18">
                  <i class="fa fa-wrench"></i>
                  ADMIN
                </h4>
                <h5>
                  <ul class="list-unstyled">
                    <li><i class="fa fa-pencil"></i> <%= link_to "Edit this studio", "/studios/#{@studio.id}/edit" %></li>
                    <li><i class="fa fa-minus-circle"></i> <%= link_to "Delete this studio", "/studios/#{@studio.id}/", method: :delete %></li>
                    <li><i class="glyphicon glyphicon-camera"></i> <%= link_to "Update studio images", "/studios/#{@studio.id}/images" %></li>
                    <li><i class="fa fa-user"></i> Owner: <span class="text-warning"><%= @studio.user.email %></span></li>
                  </ul>
                </h5>
                <div class="divider divider-center"><!-- divider -->
                  <i class="fa fa-hand-peace-o"></i>
                </div>
                <% end %>

                <% if user_signed_in? && current_user.role_id == 2 && (@studio.id == current_user.studio.first.id) %>
                <h4 class="size-18">
                  <i class="fa fa-wrench"></i>
                  STUDIO OWNER ADMIN
                </h4>
                <h5>
                  <ul class="list-unstyled">
                    <li><i class="fa fa-pencil"></i> <%= link_to "Edit your studio details", "/studios/#{@studio.id}/edit" %></li>
                    <li><i class="glyphicon glyphicon-camera"></i> <%= link_to "Update studio images", "/studios/#{@studio.id}/images" %></li>
                  </ul>
                </h5>
                <div class="divider divider-center"><!-- divider -->
                  <i class="fa fa-hand-peace-o"></i>
                </div>
                <% end %>


              </div>
              <!-- /IMAGE -->

              <!-- ITEM DESC -->
              <div class="col-lg-5 col-sm-8">



                <!-- price -->
                <div class="shop-item-price text-center">
                  <% if @studio.logo_url %>
                  <img src="<%= @studio.logo_url %>" alt="company logo" class="studio-logo">
                  <% end %>
                </div>
                <!-- /price -->

                <hr />

                <div class="clearfix margin-bottom-30">
                  <!-- <span class="pull-right text-success"><i class="fa fa-check"></i> In Stock</span> -->
                <!--
                <span class="pull-right text-danger"><i class="glyphicon glyphicon-remove"></i> Out of Stock</span>
              -->

              <h4 class="text-center">
                <ul class="list-unstyled padding-20 size-16">
                  <li class="padding-10"><i class="fa fa-globe text-info"></i>&nbsp;<%= link_to @studio.website, "http://#{@studio.website}", target: '_blank', title: 'Visit website'%></li>
                  <li>
                    <% if @studio.class_schedule_link %>
                    <li class="padding-10"><i class="fa fa-calendar text-info"></i><%= link_to "Studio's Class Schedule", "http://#{@studio.class_schedule_link}", target: '_blank', title: 'View studio schedule'%></li>
                    <% end %>
                  </li>
                  <li class="padding-10"><i class="fa fa-car"></i><%= link_to @studio.address, "http://maps.google.com/?saddr=Current+Location&daddr=#{@studio.address}", target: '_blank', title: 'See map and get directions' %></li>
                  <li class="padding-10"><i class="fa fa-envelope"></i><%= @studio.email %></li>
                  <li class="padding-10"><i class="fa fa-phone"></i><%= @studio.phone %></li>

                  <div class="divider divider-center"><!-- divider -->
                    <i class="fa fa-hand-peace-o"></i>
                  </div>
                  
                  
                </h4>

              </ul>

            </div>



          </div>
          <!-- /ITEM DESC -->

          <!-- INFO -->
          <div class="col-sm-4 col-md-3">


            <!-- rating -->
            <div class="text-center">
              <% if @reviews.any? %>
              <h3><span class="label label-danger padding-10 bold"><i class="fa fa-star"></i> Average Rating: <%= @average_rating %> / 5</span></h3>
              <div class="divider divider-center"><!-- divider -->
                <i class="fa fa-hand-peace-o"></i>
              </div>
              <% end %>
              
              <!-- /rating -->
              <h3><span class="label label-success padding-10 bold">
                <i class="glyphicon glyphicon-list"></i>
                <%= link_to "Yoga Loca Class Listings", "/yoga_classes?studio=#{@studio.id}" %></span>
              </h3>

              <div class="divider divider-center"><!-- divider -->
                <i class="fa fa-hand-peace-o"></i>
              </div>
              <!-- countdown -->
              <% if @studio.yoga_classes.any? %>
              <h3><i class="fa fa-clock-o"></i> <%= link_to "Next class starts in:", "/yoga_classes/#{@next_class.id}" %>
                <div class="countdown" data-from="<%= @next_class.start + 6.hours %>" data-labels="years,months,weeks,days,hour,min,sec"><!-- Example Date From: December 31, 2018 15:03:26 --></div></h3>
                <div class="divider divider-center"><!-- divider -->
                  <i class="fa fa-hand-peace-o"></i>
                </div>
                <% end %>
                <!-- /countdown -->


              </div>
            </div>
            <!-- /INFO -->

          </div>

          <ul id="myTab" class="nav nav-tabs nav-top-border margin-top-80" role="tablist">
            <li role="presentation" class="active"><a href="#description" role="tab" data-toggle="tab">Description</a></li>
            <li role="presentation"><a href="#specs" role="tab" data-toggle="tab">Amenities</a></li>
            <li role="presentation"><a href="#reviews" role="tab" data-toggle="tab">Reviews (<%= @reviews.length %>)</a></li>
          </ul>




          <div class="tab-content padding-top-20">

            <!-- DESCRIPTION -->
            <div role="tabpanel" class="tab-pane fade in active" id="description">
              <p><%= @studio.description %></p>
            </div>
            
            <!-- SPECIFICATIONS -->
            <div role="tabpanel" class="tab-pane fade" id="specs">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Amenity</th>
                      <th>Available?</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Yoga mats and props for use</td>
                      <td><i class="fa fa-check text-success"></i> YES</td>
                    </tr>
                    <tr>
                      <td>Showers</td>
                      <td><i class="glyphicon glyphicon-remove text-danger"></i> NO</td>
                    </tr>
                    <tr>
                      <td>Lockers</td>
                      <td><i class="fa fa-check text-success"></i> YES</td>
                    </tr>
                    <tr>
                      <td>Retail clothes and equiptment</td>
                      <td><i class="glyphicon glyphicon-remove text-danger"></i> NO</td>
                    </tr>
                    <tr>
                      <td>Snacks for sale</td>
                      <td><i class="fa fa-check text-success"></i> YES</td>
                    </tr>
                    <tr>
                      <td>Wi-Fi</td>
                      <td><i class="glyphicon glyphicon-remove text-danger"></i> NO</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <!-- REVIEWS -->
            <div role="tabpanel" class="tab-pane fade" id="reviews">
              <!-- REVIEW ITEM -->
              <% @reviews.each do |review| %>
              <div class="block margin-bottom-60">

                <span class="user-avatar"><!-- user-avatar -->
                  <img class="pull-left media-object" src="/assets/images/avatar2.jpg" width="64" height="64" alt="">
                </span>

                <div class="media-body">
                  <h4 class="media-heading size-14">
                    <%= review.user.first_name %> <%= review.user.last_name[0, 1] %>. &ndash; 
                    <span class="text-muted"><%= review.created_at.strftime("%A, %b %d, %Y") %></span> &ndash;
                    <span>
                      <div class="rating rating-<%= review.rating %> size-15 margin-top-10 width-150"></div>
                    </span>
                  </h4>
                  
                  <p>
                    <%= review.review %>
                  </p>

                </div>
                <% if user_signed_in? && ((current_user.role_id == 1) || (current_user.id == review.user.id)) %>
                <%= link_to "Delete this review", "/studios/#{@studio.id}/reviews/#{review.id}/", method: :delete %>
                <% end %>
              </div>
              <% end %>
              <!-- /REVIEW ITEM -->


              <!-- REVIEW FORM -->
              <% if user_signed_in? %>
              <h4 class="page-header margin-bottom-40">ADD A REVIEW</h4>
              <form method="post" action="/studios/review" id="form">

                <div class="row margin-bottom-10">

                  <div class="col-md-6 margin-bottom-10">
                    <!-- Name -->

                    <h4> <strong>Reviewer Name: </strong> <%= current_user.first_name %> <%= current_user.last_name[0,1] %>.</h4>
                  </div>
                  
                  <div class="col-md-6">
                    <!-- Rating -->
                    <input type="number" name="rating" id="rating" class="form-control stepper" placeholder="Your Rating" min="0" max="5" required="">
                  </div>
                  <input type="hidden" name="studio_id" id="studio_id" value="<%= @studio.id %>">
                  <input type="hidden" name="user_id" id="user_id" value="<%= current_user.id %>">
                </div>
                
                <!-- Comment -->
                <div class="margin-bottom-30">
                  <textarea name="review" id="review" class="form-control" rows="6" placeholder="Write your review" maxlength="1000" required=""></textarea>
                </div>


                <!-- Send Button -->
                <button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> Submit Review</button>
                
              </form>
              <% end %>
              <!-- /REVIEW FORM -->

            </div>
          </div>


          <hr class="margin-top-80 margin-bottom-80" />



        </div>

      </div>
    </div>
  </div>

</section>
<!-- /SLIDER -->
<!-- FOOTER -->
<footer id="footer">


  <div class="copyright">
    <div class="container">
      <ul class="pull-right nomargin list-inline mobile-block">
        <li>“Practice and all is coming.” ~ Sri K. Pattabhi Jois</li>
        <li>&bull;</li>
        <li>Namaste</li>
      </ul>
      &copy; Yoga Loca
    </div>
  </div>
</footer>
    <!-- /FOOTER -->